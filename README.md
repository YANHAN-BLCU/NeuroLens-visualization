# NeuroLens Dashboard

A comprehensive visualization dashboard for analyzing and exploring safety neurons in large language models (LLMs), developed as part of the NeuroBreak research project.

## Overview

NeuroLens provides an interactive multi-panel interface for visualizing and analyzing dedicated safety neurons in transformer-based language models. It enables researchers to understand how safety mechanisms are implemented across different layers and components of neural networks.

## Features

- **Multi-Panel Dashboard**: 11 interactive visualization panels (A-K)
- **Real-time Language Switching**: Full support for English and Chinese (中文)
- **Force-Directed Graph**: Visualize neuron connections and relationships
- **Layer-wise Analysis**: Explore neuron behavior across model layers
- **Instance Inspection**: Examine specific jailbreak instances and their interactions
- **Heatmap Visualization**: Cross-layer semantic similarity heatmaps
- **Sankey Diagram**: Attack path flow visualization
- **Violin Plot**: Neuron activation distribution analysis
- **RESTful API**: Backend API for data access and processing

## Panels

| Panel | Description |
|-------|-------------|
| **A - Control Panel** | Model selection, API configuration, safety neuron parameters |
| **B - Metric View** | Performance metrics and evaluation data (ASR, utility scores) |
| **C - Representation View** | Decision boundary visualizations per layer |
| **D - Layer View** | Layer-wise neuron analysis with streamgraph visualization |
| **E - Neuron View** | Force-directed graph of dedicated safety neurons |
| **F - Heatmap View** | Cross-layer semantic similarity heatmap |
| **G - Sankey View** | Attack path flow from methods to outcomes |
| **H - Violin View** | Neuron activation distribution by quadrant |
| **K - Instance View** | Jailbreak instance table with detailed information |

## Prerequisites

- Node.js 18+
- npm or yarn
- Python 3.8+ (for backend API)
- Modern web browser (Chrome, Firefox, Edge)

## Installation

```bash
# Install dependencies
npm install

# Start development server
npm run dev

# Build for production
npm run build
```

## Project Structure

```
visualization/
├── index.html              # Main dashboard entry point
├── package.json            # Project dependencies (Node.js)
├── requirements-api.txt   # Python API dependencies
├── vite.config.ts          # Vite build configuration
├── start_backend.py        # Backend server startup script
├── api/
│   └── main.py             # FastAPI backend server
├── vis/
│   ├── panel_A_control.html        # Control panel
│   ├── panel_B_metric.html         # Metric view
│   ├── panel_C_representation.html # Representation view
│   ├── panel_D_layer.html          # Layer view with streamgraph
│   ├── panel_E_neuron.html          # Neuron graph view
│   ├── panel_F_heatmap.html        # Cross-layer similarity heatmap
│   ├── panel_G_sankey.html         # Attack path Sankey diagram
│   ├── panel_H_violin.html          # Neuron activation violin plot
│   ├── panel_K_instance.html        # Jailbreak instance table
│   └── generate_representation_data.py  # Data generation script
└── outputs/                # Data files (generated by analysis scripts)
    ├── dedicated_safety_neurons.json
    ├── base_evaluation.jsonl
    ├── representation/
    ├── probes/
    ├── layer_evolution/
    ├── gradient_dependency/
    ├── quadrant_classification/
    └── ...
```

## Data Format

The dashboard loads data from the `outputs/` directory. Key data files:

- `dedicated_safety_neurons.json` - Identified safety neurons with layer/quadrant info
- `outputs/representation/` - Layer-wise representation data
- `outputs/probes/` - Probe training results per layer
- `outputs/layer_evolution/` - Streamgraph and semantic evolution data
- `outputs/gradient_dependency/` - Gradient dependency visualization data
- `outputs/quadrant_classification/` - Quadrant classification data
- `base_evaluation.jsonl` - Jailbreak evaluation results

## Language Support

NeuroLens supports both English and Chinese (中文). Use the settings panel (gear icon in top bar) to switch languages:

- Menu bar and UI elements
- Panel titles and labels
- Chart titles and legends
- Table headers

## Technologies

- **Frontend**: React 18, Vite, TypeScript
- **Visualization**: D3.js (force-directed graphs, Sankey), ECharts (charts, heatmaps)
- **Styling**: Tailwind CSS
- **State Management**: Zustand
- **Backend**: FastAPI (Python), Uvicorn
- **API**: RESTful endpoints for data access

## Usage

### Frontend

1. Install dependencies: `npm install`
2. Start the development server: `npm run dev`
3. Open browser at `http://localhost:5173`
4. Use the Control Panel (A) to:
   - Select model folder
   - Configure API settings (optional)
   - Adjust safety neuron parameters (sparsity, P, Q values)
5. Explore different layers using the layer selector
6. Switch between English and Chinese as needed

### Backend API (Optional)

The backend API provides additional data processing capabilities:

```bash
# Install Python dependencies
pip install -r requirements-api.txt

# Start backend server
python start_backend.py
# Or: uvicorn api.main:app --host 0.0.0.0 --port 5000

# Backend runs at http://localhost:5000
# API documentation: http://localhost:5000/docs
```

## Configuration

### Safety Neuron Parameters

- **Sparsity (%)**: Percentage of neurons to identify as safety neurons
- **P**: Probability threshold for quadrant classification
- **Q**: Secondary threshold parameter

### Layer Selection

- All Layers (0-32)
- Layers 0-16 (early layers)
- Layers 17-32 (late layers)

## Development

```bash
# Run frontend with hot reload
npm run dev

# Build production version
npm run build

# Preview production build
npm run preview

# Start backend API server (optional)
python start_backend.py

# Or run backend directly with uvicorn
uvicorn api.main:app --host 0.0.0.0 --port 5000 --reload
```

### API Endpoints

The backend provides the following RESTful endpoints:

| Endpoint | Description |
|----------|-------------|
| `/api/metrics` | Get ASR and utility metrics |
| `/api/representation/{layer}` | Get representation data for a layer |
| `/api/layers` | Get layer evolution and gradient data |
| `/api/neurons` | Get safety neuron information |
| `/api/instances` | Get jailbreak instances |
| `/api/layer_similarity` | Get cross-layer similarity matrix |
| `/api/attack_paths` | Get attack path data for Sankey |
| `/api/neuron_activations` | Get neuron activation data for violin plot |

## License

This project is part of the NeuroBreak research project.

## Version

Current version: 1.0.0
